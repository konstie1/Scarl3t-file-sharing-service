const TelegramBot = require('node-telegram-bot-api');
const config = require('./config.json');

(async () => {
  try {
    // –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞
    const bot = new TelegramBot(config.token, { polling: true });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    bot.on('message', async (msg) => {
      
      if (msg.text) {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É
        var content = msg.text;
        var contentediting = content.substr(0, 1);
        if(contentediting == "/") {
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ –±–æ—Ç–µ 
          var command = config.command
          var contentcommand = content.replace("/", "");
          if(!command.includes(contentcommand)) {
            // –û—à–∏–±–∫–∞
            if (msg.chat.type === 'supergroup' || msg.chat.type === 'group') return;
            const captionText = `*–ü—Ä–∏–≤–µ—Ç!* üòä –Ø –±–æ—Ç *–ø–æ–¥–¥–µ—Ä–∂–∫–∏*, –≥–æ—Ç–æ–≤—ã–π *–ø–æ–º–æ—á—å —Ç–µ–±–µ* –≤ —Ä–∞–±–æ—Ç–µ. –ï—Å–ª–∏ —É —Ç–µ–±—è –≤–æ–∑–Ω–∏–∫–ª–∏ *–≤–æ–ø—Ä–æ—Å—ã* –∏–ª–∏ *–ø—Ä–æ–±–ª–µ–º—ã*, –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ *—Å–æ–æ–±—â–µ–Ω–∏–µ* –≤ —ç—Ç–æ—Ç —á–∞—Ç. –Ø *–ø–æ—Å—Ç–∞—Ä–∞—é—Å—å* –æ—Ç–≤–µ—Ç–∏—Ç—å –∫–∞–∫ *–º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ*.\n\n–û–±—Ä–∞—Ç–∏ *–≤–Ω–∏–º–∞–Ω–∏–µ*, —á—Ç–æ —É –Ω–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω *—Ç–∞–π–º–∞—É—Ç*, –≤—ã –º–æ–∂–µ—Ç–µ *–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å* —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–∑ –≤ *15 –º–∏–Ω—É—Ç*. ‚è∞ –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å *–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω—ã–π* –∏ *–ø–æ–ª–µ–∑–Ω—ã–π* –æ—Ç–≤–µ—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å *–º–∞–∫—Å–∏–º—É–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏* –æ —Å–≤–æ–µ–π –ø—Ä–æ–±–ª–µ–º–µ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–µ.\n\n –ß–µ–º *–±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π* —Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—à—å, —Ç–µ–º –ª—É—á—à–µ *—è —Å–º–æ–≥—É* –ø–æ–º–æ—á—å. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è *–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å* –∫–∞–∫–∏–µ-–ª–∏–±–æ *—Ñ–∞–π–ª—ã* –∏–ª–∏ *—Å–∫—Ä–∏–Ω—à–æ—Ç—ã*, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è *–æ—Ç–ø—Ä–∞–≤–∏—Ç—å* –∏—Ö –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º. –Ø –≥–æ—Ç–æ–≤ *–ø–æ–º–æ—á—å* —Ç–µ–±–µ, —Ç–∞–∫ —á—Ç–æ *–Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è* –æ–±—Ä–∞—â–∞—Ç—å—Å—è! üòâ`;
            await bot.sendMessage(msg.chat.id, `ü§î –Ø *–Ω–µ –º–æ–≥—É* –Ω–∞–π—Ç–∏ –∫–æ–º–∞–Ω–¥—É ${content}`, { parse_mode: "Markdown" });
            await bot.sendPhoto(msg.chat.id, "https://media.discordapp.net/attachments/1088507989956231188/1114614330005131405/Frame_14.png?width=1440&height=555", { caption: captionText, parse_mode: "Markdown" })
            return;
          };
        }
        if(contentediting == "/") return;
      }  
      try {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –õ–°
        if (msg.chat.type === 'private') {
          // –ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É
          const forwardedMsg = await bot.forwardMessage(config.groupId, msg.chat.id, msg.message_id);

          // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
          const ownerId = msg.from.id;

          // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º ID –≤–ª–∞–¥–µ–ª—å—Ü–∞
          await bot.sendMessage(forwardedMsg.chat.id, `‚ùï <b>–°–æ–æ–±—â–µ–Ω–∏–µ –≤—ã—à–µ</b> –ø—Ä–∏—Å–ª–∞–ª <a href="tg://user?id=${ownerId}">${ownerId}</a>.\nü§ñ <b>–ö–æ–º–∞–Ω–¥–∞</b>: <code>\/m ${ownerId}</code>`, { parse_mode: 'HTML', reply_to_message_id: forwardedMsg.message_id });
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error.message);
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    bot.onText(/\/start/, async (msg) => {
        if (msg.chat.type === 'supergroup' || msg.chat.type === 'group') return bot.sendMessage(msg.chat.id, "‚õî *–û—à–∏–±–∫–∞*! –ö–æ–º–∞–Ω–¥—ã *—Ä–∞–±–æ—Ç–∞—é—Ç* —Ç–æ–ª—å–∫–æ –≤ *–õ–°*.", { reply_to_message_id: msg.message_id, parse_mode: "Markdown" });
        const chatId = msg.chat.id;
        const username = msg.from.username;
        const dateAdded = Date.now();

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        const inlineKeyboard = {
            inline_keyboard: [
                [
                    {
                        text: 'ü§ñ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç',
                        url: 'https://t.me/Scarl3t_bot',
                    },
                ],
            ],
        };
        const captionText = `*–ü—Ä–∏–≤–µ—Ç!* üòä –Ø –±–æ—Ç *–ø–æ–¥–¥–µ—Ä–∂–∫–∏*, –≥–æ—Ç–æ–≤—ã–π *–ø–æ–º–æ—á—å —Ç–µ–±–µ* –≤ —Ä–∞–±–æ—Ç–µ. –ï—Å–ª–∏ —É —Ç–µ–±—è –≤–æ–∑–Ω–∏–∫–ª–∏ *–≤–æ–ø—Ä–æ—Å—ã* –∏–ª–∏ *–ø—Ä–æ–±–ª–µ–º—ã*, –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ *—Å–æ–æ–±—â–µ–Ω–∏–µ* –≤ —ç—Ç–æ—Ç —á–∞—Ç. –Ø *–ø–æ—Å—Ç–∞—Ä–∞—é—Å—å* –æ—Ç–≤–µ—Ç–∏—Ç—å –∫–∞–∫ *–º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ*.\n\n–û–±—Ä–∞—Ç–∏ *–≤–Ω–∏–º–∞–Ω–∏–µ*, —á—Ç–æ —É –Ω–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω *—Ç–∞–π–º–∞—É—Ç*, –≤—ã –º–æ–∂–µ—Ç–µ *–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å* —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–∑ –≤ *15 –º–∏–Ω—É—Ç*. ‚è∞ –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å *–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω—ã–π* –∏ *–ø–æ–ª–µ–∑–Ω—ã–π* –æ—Ç–≤–µ—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å *–º–∞–∫—Å–∏–º—É–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏* –æ —Å–≤–æ–µ–π –ø—Ä–æ–±–ª–µ–º–µ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–µ.\n\n –ß–µ–º *–±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π* —Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—à—å, —Ç–µ–º –ª—É—á—à–µ *—è —Å–º–æ–≥—É* –ø–æ–º–æ—á—å. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è *–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å* –∫–∞–∫–∏–µ-–ª–∏–±–æ *—Ñ–∞–π–ª—ã* –∏–ª–∏ *—Å–∫—Ä–∏–Ω—à–æ—Ç—ã*, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è *–æ—Ç–ø—Ä–∞–≤–∏—Ç—å* –∏—Ö –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º. –Ø –≥–æ—Ç–æ–≤ *–ø–æ–º–æ—á—å* —Ç–µ–±–µ, —Ç–∞–∫ —á—Ç–æ *–Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è* –æ–±—Ä–∞—â–∞—Ç—å—Å—è! üòâ`;
        await bot.sendMessage(msg.chat.id, `üëã *–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é!*`, { parse_mode: 'Markdown' });
        await bot.sendPhoto(chatId, "https://media.discordapp.net/attachments/1088507989956231188/1114614330005131405/Frame_14.png?width=1440&height=555", { caption: captionText, parse_mode: "Markdown", reply_markup: inlineKeyboard })
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    bot.onText(/\/m (.+)/, async (msg, match) => {
      try {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –≥—Ä—É–ø–ø—ã config.groupId
        if (msg.chat.id.toString() === config.groupId) {
          try {
            const targetId = match[1]; // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥—ã
            const messageText = match[0].split(' ').slice(2).join(' '); // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥—ã

            if (messageText) {
              // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É ID
              await bot.sendMessage(targetId, messageText);

              // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
              await bot.deleteMessage(msg.chat.id, msg.message_id)
              await bot.sendMessage(msg.chat.id, `–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ ID: ${targetId}`);
            } else {
              // –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
              await bot.sendMessage(msg.chat.id, '‚õî *–û—à–∏–±–∫–∞*! –í—ã *–Ω–µ —É–∫–∞–∑–∞–ª–∏* —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.');
            }
          } catch (error) {
            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É –≤ —á–∞—Ç
            await bot.sendMessage(msg.chat.id, `–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: ${error.message}`);
          }
        } else {
          // –û—Ç–≤–µ—Ç –≤ —Å–ª—É—á–∞–µ –∫–æ–º–∞–Ω–¥—ã, –≤—ã–∑–≤–∞–Ω–Ω–æ–π –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —á–∞—Ç–µ
          await bot.sendMessage(msg.chat.id, '–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ.');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–∞–Ω–¥—ã:', error.message);
      }
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error.message);
  }
  
})();    